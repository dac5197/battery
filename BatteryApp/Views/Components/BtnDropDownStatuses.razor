@inject IChargeService _chargeService

<button id="statusCharge-@Charge.Id" type="button" class="btn btn-sm border-square dopdown-toggle mx-1 py-0 px-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
        style="color: @status.FontColor; background-color: @status.BgColor">
    @status.Name
</button>
<div class="dropdown-menu" aria-labelledby="statusCharge-@Charge.Id">
    @foreach (var s in Statuses.OrderBy(x => x.Order))
    {
        @if (s.Id == Charge.StatusId)
        {
            <a class="dropdown-item small bg-info"> @s.Name</a>
        }
        else
        {
            <a class="dropdown-item small" href="" @onclick="@(() => ChangeChargeStatus(s.Id))" @onclick:preventDefault="true"> @s.Name</a>
        }
    }
</div>

@code {
    [Parameter]
    public Charge Charge { get; set; }

    [Parameter]
    public List<Status> Statuses { get; set; }

    [Parameter]
    public Action ParentStateChanged { get; set; }

    private Status status = new();

    protected override void OnInitialized()
    {
        status = Statuses.Where(x => x.Id == Charge.StatusId).FirstOrDefault();
        base.OnInitialized();
    }

    private async void ChangeChargeStatus(int statusId)
    {
        Charge.StatusId = statusId;
        await _chargeService.Update(Charge);
        ParentStateChanged?.Invoke();
    }
}
